<loader
  [isReady]="isReady">

  <layout
    [title]="title"
    [isScroll]="true"
    [state]="state"
    [titleHidden]="isSearchMode"
    [navHidden]="isSearchMode">

    <!-- actions -->
    <layout-actions
      actions
      [searchText]="searchText"
      [isSearchMode]="isSearchMode"
      (onSearch)="onSearch($event)"
      (onSearchModeChange)="onSearchModeChange($event)">
    </layout-actions>

    <!-- content -->
    <div
      content>

      <favorite-empty-state
        *ngIf="lectures.isEmpty && isFavoriteSelected && !isSearchEmptyStateVisible">
      </favorite-empty-state>

      <now-empty-state
        *ngIf="isNowEmptyStateVisible">
      </now-empty-state>

      <search-empty-state
        *ngIf="isSearchEmptyStateVisible">
      </search-empty-state>

      <!-- tags -->
      <nav
        *ngIf="isFiltersVisible"
        pre-content
        class="tags">

        <div
          class="tags__wrapper">

          <!-- buttons group -->
          <div
            [class.buttons-group--selected]="isAllSelected"
            class="tags__item buttons-group">

            <!-- filters -->
            <button
              cf-button
              (click)="onFilter()"
              class="button-tag button-icon-only">

              <svg
                aria-hidden="true"
                width="16" height="14" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                <path d="M8.17 10a3 3 0 0 1 5.66 0H15a1 1 0 0 1 0 2h-1.17a3 3 0 0 1-5.66 0H1a1 1 0 0 1 0-2h7.17zm-6-8a3 3 0 0 1 5.66 0H15a1 1 0 0 1 0 2H7.83a3 3 0 0 1-5.66 0H1a1 1 0 1 1 0-2h1.17zM5 2a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm6 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd"/>
              </svg>

              <span
                class="visually-hidden">
              Set up filters:
            </span>
            </button>

            <!-- all -->
            <button
              cf-button
              (click)="isAllSelected ? onFilter() : onShowAllClick()"
              class="button-tag">

            <span
              class="visually-hidden">
              Selected:
            </span>

              &ngsp;{{ filterTitle }}
            </button>
          </div>

          <button
            cf-button
            (click)="onShowFavoriteClick()"
            [class.button-primary]="isFavoriteSelected"
            class="tags__item button-tag">
            Favorites
          </button>

          <!--<button-->
          <!--cf-button-->
          <!--(click)="onShowCustomClick()"-->
          <!--[class.button-primary]="isCustomSelected"-->
          <!--class="tags__item button-tag">-->
          <!--События-->
          <!--</button>-->

          <button
            cf-button
            (click)="onShowNowClick()"
            [class.button-primary]="isNowSelected"
            class="tags__item button-tag">
            Live
          </button>
        </div>
      </nav>

      <!-- schedule -->
      <div
        class="schedule">

        <!-- day section -->
        <section
          *ngFor="let groupedByDay of groupedLectures; let i = index"
          class="schedule__section">

          <!-- day title -->
<!--          <header-->
<!--            class="schedule__header">-->

<!--            <time-->
<!--              class="schedule__date">-->
<!--              {{ getDay(groupedByDay) }}-->
<!--            </time>-->
<!--          </header>-->

          <!-- day events grouped by time -->
          <div
            *ngFor="let lectures of groupedByDay"
            class="schedule__events events">

            <!-- time -->
            <template
              ngFor
              [ngForOf]="lectures"
              let-lecture
              let-i="index">

              <template
                [ngIf]="i == 0">

                <div
                  [attr.id]="currentTimeId(lecture)"
                  [class.time--right-now]="isRightNow(lecture)"
                  [class.time--finished]="isFinished(lecture)"
                  class="events__time time">

                  <!-- time -->
                  <div
                    class="time__container">

                    <!-- start -->
                    <time
                      class="time__item time__item-start">
                      {{ startTime(lecture) }}
                    </time>

                    <!-- end -->
                    <time
                      class="time__item">
                      {{ endTime(lecture) }}
                    </time>
                  </div>

                  <div
                    class="time__placeholder">
                  </div>
                </div>
              </template>
            </template>

            <!-- events -->
            <div
              class="events__list">

              <template
                ngFor
                [ngForOf]="lectures"
                let-lecture
                let-i="index">

                <div
                  class="schedule__event event">

                  <!-- details -->
                  <article
                    (click)="onLectureSelect(lecture)"
                    class="event__info event-card">

                    <svg
                      aria-hidden="true"
                      *ngIf="isWrikeEvent(lecture)"
                      class="event-card__figure">

                      <use
                        [attr.xlink:href]="getFigure(lecture.figureNumber)">
                      </use>
                    </svg>

                    <!-- meta -->
                    <div
                      class="event-card__meta">

                      <!-- location -->
                      <span
                        class="event-card__meta-item">
                        {{ lecture.location.title }}
                      </span>

                      &ngsp;•&ngsp;

                      <!-- section -->
                      <span
                        class="event-card__meta-item event-card__meta-item--section"
                        [style.color]="lecture.section.color">
                        {{ lecture.section.title }}
                      </span>

                      <!--{{ flag(lecture) }}-->
                    </div>

                    <!-- title -->
                    <h1
                      class="event-card__title">
                      {{ lecture.title }}
                    </h1>

                    <!-- speakers (todo: info item) -->
                    <div
                      *ngIf="lecture.speakers.length != 0"
                      class="event-card__speakers info-item">

                      <!-- media -->
                      <div
                        class="info-item__media">

                        <span
                          *ngFor="let speaker of lecture.speakers"
                          class="info-item__media-container">

                          <img
                            [src]="speaker.avatarPath"
                            [alt]="speaker.name"
                            class="info-item__media-image">
                        </span>
                      </div>

                      <!-- details -->
                      <div
                        class="info-item__details">


                        <!-- title -->
                        <div
                          class="info-item__title">

                          <ng-container
                            *ngFor="let speaker of lecture.speakers">
                            <div>{{ speaker.name }}</div>
                          </ng-container>
                        </div>

                        <!-- Subtitle -->
                        <div
                          class="info-item__subtitle">

                          <div class="info-item__subtitle-wrapper">
                            <ng-container
                              *ngIf="lecture.speakers.first != null">
                              <div>{{ lecture.speakers.first.company }}</div>
                            </ng-container>
                          </div>

                          <!-- actions -->
                          <div
                            class="event-card__actions actions">

                            <span
                              class="event-card__language">
                              {{ getLang(lecture) }}
                            </span>

                            <actions
                              [popularity]="lecture.favoritesCount"
                              [maxPopularity]="maxPopularity"
                              [isFavorite]="isFavoriteLecture(lecture)"
                              (onFavoriteChange)="onFavoriteChange(lecture, $event)">
                            </actions>
                          </div>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>
              </template>
            </div>
          </div>
        </section>
      </div>
    </div>
  </layout>
</loader>
